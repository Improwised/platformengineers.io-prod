<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" http-equiv="Content-Language" content="en"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" name="author" content="Platform Engineers"><meta data-n-head="ssr" name="copyright" content="Platform Engineers"><meta data-n-head="ssr" name="robots" content="index, follow"><meta data-n-head="ssr" name="theme-color" content="#179bfd"><meta data-n-head="ssr" name="application-name" content="Platform Engineers"><meta data-n-head="ssr" name="msapplication-TileColor" content="#FFFFFF"><meta data-n-head="ssr" name="msapplication-TileImage" content="/img/favicon/ms-icon-144x144.png"><meta data-n-head="ssr" name="msapplication-square70x70logo" content="/img/favicon/ms-icon-70x70.png"><meta data-n-head="ssr" name="msapplication-square144x144logo" content="/img/favicon/ms-icon-144x144.png"><meta data-n-head="ssr" name="msapplication-square150x150logo" content="/img/favicon/ms-icon-150x150.png"><meta data-n-head="ssr" name="msapplication-square310x310logo" content="/img/favicon/ms-icon-310x310.png"><meta data-n-head="ssr" name="description" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" name="title" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" property="og:type" content="website"><meta data-n-head="ssr" property="og:url" content="https://platformengineers.io/blog/teleport-for-simplified-kubernetes-access-management/"><meta data-n-head="ssr" property="og:title" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" property="og:description" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" property="og:image" content="https://platformengineers.io/_nuxt/image/6932ec.png"><meta data-n-head="ssr" property="twitter:card" content="summary"><meta data-n-head="ssr" property="twitter:site" content=""><meta data-n-head="ssr" property="twitter:creator" content=""><meta data-n-head="ssr" property="twitter:title" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" property="twitter:description" content="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers"><meta data-n-head="ssr" property="twitter:image" content="https://platformengineers.io/_nuxt/image/6932ec.png"><link data-n-head="ssr" href="https://fonts.googleapis.com" rel="preconnect"><link data-n-head="ssr" href="https://maps.googleapis.com" rel="preconnect"><link data-n-head="ssr" href="https://www.gstatic.com" rel="preconnect"><link data-n-head="ssr" rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-icon-57x57.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-icon-60x60.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-icon-72x72.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-icon-76x76.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-icon-114x114.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-icon-120x120.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-icon-144x144.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-icon-152x152.png"><link data-n-head="ssr" rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-icon-180x180.png"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/img/favicon/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/png" href="/img/favicon/favicon-16x16.png" sizes="16x16"><link data-n-head="ssr" rel="icon" type="image/png" href="/img/favicon/favicon-32x32.png" sizes="32x32"><link data-n-head="ssr" rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96"><link data-n-head="ssr" rel="manifest" href="/manifest.json"><link data-n-head="ssr" rel="canonical" href="https://platformengineers.io/blog/teleport-for-simplified-kubernetes-access-management/"><link data-n-head="ssr" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/monokai-sublime.min.css"><script data-n-head="ssr" type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"Platform Engineers","alternateName":"Platform Engineers","url":"https://platformengineers.io/","image":"https://platformengineers.io/img/plateform-engineers.png","sameAs":[]}</script><link rel="preload" href="/_nuxt/7dc4e7c.js" as="script"><link rel="preload" href="/_nuxt/0f88427.js" as="script"><link rel="preload" href="/_nuxt/css/64240c5.css" as="style"><link rel="preload" href="/_nuxt/990548d.js" as="script"><link rel="preload" href="/_nuxt/b4cbe7a.js" as="script"><link rel="preload" href="/_nuxt/css/998d57e.css" as="style"><link rel="preload" href="/_nuxt/1d8d9a4.js" as="script"><link rel="preload" href="/_nuxt/css/01649ec.css" as="style"><link rel="preload" href="/_nuxt/accecf1.js" as="script"><link rel="stylesheet" href="/_nuxt/css/64240c5.css"><link rel="stylesheet" href="/_nuxt/css/998d57e.css"><link rel="stylesheet" href="/_nuxt/css/01649ec.css"><link rel="preload" href="/_nuxt/static/1730278824/blog/teleport-for-simplified-kubernetes-access-management/state.js" as="script"><link rel="preload" href="/_nuxt/static/1730278824/blog/teleport-for-simplified-kubernetes-access-management/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1730278824/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div><link rel="stylesheet" type="text/css" href="/dist/main.min.css" media="all"> <link rel="stylesheet" type="text/css" href="/dist/fontsicon.min.css"></div> <a id="start" rel="nofollow" aria-label="start point of page" href="javscript:void(0);"></a> <div class="main-container blog"><div class="blog-bk"><div class="nav-container"><div class="bar bar--sm visible-xs"><div class="container"><div class="row align-items-center"><div class="col-3 col-md-2"><a href="/"><img src="/_nuxt/image/e7b705.png" alt="Platform Engineers" loading="lazy" title="Platform Engineers"></a></div> <div class="col-9 col-md-10 text-right"><a href="#" aria-label="toggle" data-toggle-class="#menu1;hidden-xs" class="hamburger-toggle"><i class="icon icon--sm stack-interface stack-menu"></i></a></div></div></div></div> <nav id="menu1" data-scroll-class="366px:pos-fixed" class="bar bar--sm bar-1 hidden-xs"><div class="container"><div class="row align-items-center"><div class="hidden-xs d-flex align-items-center"><div class="bar__module"><a href="/"><img src="/_nuxt/image/418082.png" width="68" height="55" alt="Platform Engineers" loading="lazy" title="Platform Engineers"></a></div></div> <div class="col text-right text-left-xs text-left-sm"><div class="bar__module"><ul class="menu-horizontal text-left"><li><a href="/">Home</a></li> <li><a href="/about-us/">About Us</a></li> <li class="dropdown"><span class="dropdown__trigger">Services</span> <div class="dropdown__container"><div class="container"><div class="row"><div class="mt-1 dropdown__content col-lg-3 col-md-4 col-sm-6 p-3"><ul class="menu-vertical"><li><a href="/assessment/">Cost Assessment</a></li> <li><a href="/assessment/">Performance Assessment</a></li> <li><a href="/services/platform-engineering/">Platform Engineering</a></li><li><a href="/services/kubernetes-consulting-services/">Kubernetes Consulting Services</a></li><li><a href="/services/containerization/">Containerization</a></li><li><a href="/services/performance-optimization/">Performance Optimization</a></li><li><a href="/services/ci-cd-implementation/">CI/CD Implementation</a></li><li><a href="/services/infrastructure-maintenance-and-support/">Infra Maintenance & Support</a></li></ul></div></div></div></div></li> <li class="dropdown"><span class="dropdown__trigger">Industries</span> <div class="dropdown__container"><div class="container"><div class="row"><div class="mt-1 dropdown__content col-lg-3 col-md-4 col-sm-6 p-3"><ul class="menu-vertical"><li><a href="/industries/IoT/">IoT</a></li><li><a href="/industries/ecommerce/">eCommerce</a></li><li><a href="/industries/fintech/">FinTech</a></li><li><a href="/industries/SaaS/">SaaS</a></li><li><a href="/industries/enterprise/">Enterprise</a></li></ul></div></div></div></div></li> <li><a href="/blog/">Blog</a></li> <li><a href="/case-studies/">Case Studies</a></li></ul></div> <div class="bar__module"><div><a href="/contact-us/" title="contact" class="btn btn--primary type--uppercase b-30"><span class="btn__text"> Contact us </span></a></div></div></div></div></div></nav></div> <div class="container"><div class="row py-2"><div class="col-md-6 d-flex align-items-center justify-content-center"><div><h1 class="h2 mb-0">From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management</h1> <div class="lh-1 mb-3">
          Tue, 10/09/2024 |
          5 mins
        </div> <!----> <!----> <div class="row"><div class="col-lg-4 col-md-12"><div class="d-flex align-items-center mt-3"><div class="d-flex align-items-center mr-2" style="border-radius:200px"><img src="/_nuxt/image/a07868.png" width="32" height="40" alt="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management" title="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management" class="p-0 m-0 rounded author-s"></div> <div><strong class="m-0 p-0 lh-1">
                  Angita
                  Shah
                </strong></div></div></div><div class="col-lg-4 col-md-12"><div class="d-flex align-items-center mt-3"><div class="d-flex align-items-center mr-2" style="border-radius:200px"><img src="/_nuxt/image/2d1258.png" width="32" height="40" alt="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management" title="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management" class="p-0 m-0 rounded author-s"></div> <div><strong class="m-0 p-0 lh-1">
                  Shivani
                  Rathod
                </strong></div></div></div></div> <!----></div></div> <div class="col-md-6 d-flex align-items-center justify-content-center"><img src="/_nuxt/image/bf691f.png" height="400" alt="From Complexity to Control: Using Teleport for Simplified Kubernetes Access Management | Platform Engineers" decoding="async" class="img-dim" style="color:transparent"></div></div></div></div> <section class="bg-- wave-bk-1 section-padding"><div class="container"><div class="row"><div class="col-lg-10 offset-lg-1 bs-11 p-5 b-30 bg-white"><div class="fc-lead ul-list"><p dir="ltr">Securely managing access to modern infrastructure is a paramount concern, whether it's on-premises servers, cloud instances, Kubernetes clusters, databases, or other critical resources. The challenge lies in striking a balance between providing seamless access and maintaining airtight security, all while ensuring compliance with regulatory requirements. This is where Teleport steps in, offering a robust solution to streamline infrastructure access and management while prioritizing security, auditability, and compliance.</p>
<p dir="ltr">Kubernetes access management, also known as Role-Based Access Control (RBAC), is a method of controlling who can access the Kubernetes API and what actions they can perform across the cluster. It is a critical part of the overall Kubernetes security strategy. Here is a detailed demonstration of Kubernetes access management:</p>
<p dir="ltr" role="presentation"><strong>Users and Service Accounts:</strong></p>
<p dir="ltr">Users: Kubernetes does not manage user identities directly. Instead, it relies on external identity management systems. Users are authenticated and then bound to roles or cluster roles through RoleBindings or ClusterRoleBindings.</p>
<p dir="ltr">Service Accounts: These are used to authenticate pods and services within the cluster. Each pod is associated with a service account, and the service account's credentials are used to authenticate the pod's requests to the Kubernetes API.</p>
<p dir="ltr" role="presentation"><strong>Roles and ClusterRoles:</strong></p>
<p dir="ltr">Roles: Define a set of permissions within a namespace. They specify what actions can be performed on resources within that namespace.</p>
<p dir="ltr">ClusterRoles: Similar to roles but apply to cluster-wide resources and are not limited to a specific namespace.</p>
<p dir="ltr" role="presentation"><strong>RoleBindings and ClusterRoleBindings:</strong></p>
<p dir="ltr">RoleBindings: Bind a role to a user or service account within a namespace, granting the specified permissions.</p>
<p dir="ltr">ClusterRoleBindings: Bind a cluster role to a user or service account, granting cluster-wide permissions.</p>
<h3 dir="ltr"><strong>Challenge</strong></h3>
<p dir="ltr">Managing access to a Kubernetes cluster can be a complex and challenging task. It requires balancing security, scalability, and usability while ensuring compliance with regulatory requirements. As the number of users and clusters grows, managing access can become increasingly difficult, making it essential to have a robust access management system in place.</p>
<p dir="ltr">Here are some of the challenges that organizations may face when giving access to a Kubernetes cluster:</p>
<ul>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Securing Kubernetes clusters presents significant challenges. Exposing the cluster to unauthorized access increases the risk of security breaches, data theft, and unauthorized modifications. </p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">The complexity of Kubernetes environments makes managing access and ensuring appropriate permissions difficult, especially as the number of users and clusters grows. Multi-tenant setups amplify these challenges, requiring robust isolation of resources. Managing keys, certificates, and credentials adds overhead and potential error points. </p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Auditing, compliance, and providing temporary access to external parties further complicate the security landscape. Implementing least privilege access and effective monitoring and logging are essential but require careful planning and execution.</p>
</li>
</ul>
<h3 dir="ltr"><strong>Solution</strong></h3>
<p dir="ltr">Teleport is a robust and versatile tool that serves as a secure gateway to access SSH and Windows servers, Kubernetes clusters, databases, and web applications with unparalleled ease and reliability. It not only facilitates secure connectivity across diverse infrastructure components but also enhances operational efficiency by centralizing access management and enforcing stringent security policies. </p>
<p dir="ltr">Whether managing containerized applications in Kubernetes environments or ensuring controlled access to critical databases and web services, Teleport offers comprehensive solutions tailored to meet the complex security and compliance needs of modern enterprises.</p>
<p dir="ltr"><img style="height:auto" src="/_nuxt/image/bc35df.png" alt="Teleport process"></p>
<p dir="ltr">Teleport provides a more efficient and secure way to manage access to Kubernetes clusters. It offers granular control over user permissions, audit logs, and session recordings. This allows us to streamline administration, reduce the attack surface, and ensure compliance with regulatory requirements.</p>
<h3 dir="ltr"><strong>Deployment Guide</strong></h3>
<p dir="ltr"><strong>Step 1: Add the Teleport Helm Repository</strong></p>
<p dir="ltr"><a href="https://github.com/gravitational/teleport/tree/master/examples/chart/teleport-cluster">https://github.com/gravitational/teleport/tree/master/examples/chart/teleport-cluster</a></p>
<p dir="ltr">Open a terminal and run the following command to add the Teleport Helm repository</p>
<div dir="ltr" align="left">
<pre><code>helm repo add teleport https://charts.releases.teleport.dev</code></pre>
<p dir="ltr"><strong>Step 2: Update the Helm Repository</strong></p>
<p dir="ltr">Run the following command to update the Helm repository:</p>
<pre><code>helm repo update</code></pre>
<p><strong>Step 3: Install Teleport with following teleport-cluster-values.yaml</strong></p>
<pre><code>apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: teleport
  namespace: teleport
spec:
  chart:
    spec:
      chart: teleport-cluster
      reconcileStrategy: ChartVersion
      version: 16.2.0
      sourceRef:
        kind: HelmRepository
        name: teleport-helm-source
        namespace: flux-system
  interval: 10m0s
  values:
    clusterName: teleport.improwised.com
    proxyListenerMode: multiplex
    persistence:
      volumeSize: 3Gi
    proxy:
      service:
        type: ClusterIP
      annotations:
        ingress:
          nginx.ingress.kubernetes.io/backend-protocol: 'HTTPS'
          cert-manager.io/cluster-issuer: letsencrypt-prod
      highAvailability:
        replicaCount: 1
    ingress:
      enabled: true
      suppressAutomaticWildcards: true
      spec:
        ingressClassName: nginx
    authentication:
      secondFactor: "off"
    kubeClusterName: "cluster-name"
    highAvailability:
      replicaCount: 1
      certManager:
        enabled: true
        issuerName: "letsencrypt-prod"
        issuerKind: ClusterIssuer</code></pre>
<p dir="ltr">Run the following command to install Teleport to your Kubernetes cluster:</p>
<div dir="ltr" align="left">
<pre><code>helm install teleport-cluster teleport/teleport-cluster \
  --create-namespace \
  --version 16.0.3 \
  --values teleport-cluster-values.yaml</code></pre>
<p dir="ltr"><img style="height:auto" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXc7JCUtHzyycAxjXrcuIMVw_-kYZA23MQXprDTA1FM7AWKMFUpqiIMerP_XtOQGoNqZ4dgc8Usszk8EIJeJs2w6qrfHnWW18ytTad6fzSskoQx_zY8eNQ-q6hshTvzH-Uoc4utynBLhmqYEpI32bij7I7c?key=YgVxM6yyLCGPHFNJRoippg" width="800"></p>
<h3 dir="ltr"><strong>Creating role based access using teleport roles:</strong></h3>
<p dir="ltr"><img style="height:auto" src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXdQrxN-NM6TQXuubiWHrQTY8hiL6Q-T1cHsE43zYox8a_InyQuSfRKjxwHYGnwTUMLsnN15i6__yGICssinc_LfEMWoHTDetsFi0uRaosroP31iOfr641p8ceXxuzSP68k0CmIljp1ZNR7oL2h7Yg1RNKMk?key=YgVxM6yyLCGPHFNJRoippg" width="860"><strong><br></strong></p>
<p dir="ltr">After adding the cluster into teleport One can find the the guide to add the user and their access roles from teleport itself</p>
<div dir="ltr" align="left">
<pre><code>kind: role
version: v7
metadata:
  name: alice
spec:
  allow:
    logins: ['admin']
    kubernetes_groups: ['edit']
    node_labels:
      '*': '*'
    kubernetes_labels:
      '*': '*'
    kubernetes_resources:
      - kind: '*'
        namespace: '*'
        name: '*'
        verbs: ['*']
---
kind: role
version: v7
metadata:
  name: bob
spec:
  allow:
    logins: ['ubuntu']
    kubernetes_groups: ['view']
    node_labels:
      '*': '*'
    kubernetes_labels:
      '*': '*'
    kubernetes_resources:
      - kind: '*'
        namespace: '*'
        name: '*'
        verbs: ['*']</code></pre>
<h2 style="font-size:28px"><strong> Use Teleport for Kubernetes access management </strong></h2>
<h3 dir="ltr">1. Deploy Teleport</h3>
<p dir="ltr"><strong>Step 1: Add the Teleport Helm Repository</strong></p>
<p dir="ltr"><a href="https://github.com/gravitational/teleport/tree/master/examples/chart/teleport-cluster">https://github.com/gravitational/teleport/tree/master/examples/chart/teleport-cluster</a></p>
<p dir="ltr">Open a terminal and run the following command to add the Teleport Helm repository</p>
<pre><code>helm repo add teleport https://charts.releases.teleport.dev</code></pre>
<p><strong> </strong><strong>Step 2: Update the Helm Repository</strong></p>
<p><strong> </strong>Run the following command to update the Helm repository:</p>
<pre><code>helm repo update</code></pre>
<p><strong> Step 3: Install Teleport with following teleport-cluster-values.yaml</strong></p>
<p dir="ltr">Run the following command to install Teleport to your Kubernetes cluster:</p>
<pre><code>helm install teleport-cluster teleport/teleport-cluster \
  --create-namespace \
  --version 16.2.0 \
  --values teleport-cluster-values.yaml</code></pre>
<div dir="ltr" align="left">
<pre><code>apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: teleport
  namespace: teleport
spec:
  chart:
    spec:
      chart: teleport-cluster
      reconcileStrategy: ChartVersion
      version: 16.2.0
      sourceRef:
        kind: HelmRepository
        name: teleport-helm-source
        namespace: flux-system
  interval: 10m0s
  values:
    clusterName: teleport.improwised.com
    proxyListenerMode: multiplex
    persistence:
      volumeSize: 3Gi
    proxy:
      service:
        type: ClusterIP
      annotations:
        ingress:
          nginx.ingress.kubernetes.io/backend-protocol: 'HTTPS'
          cert-manager.io/cluster-issuer: letsencrypt-prod
      highAvailability:
        replicaCount: 1
    ingress:
      enabled: true
      suppressAutomaticWildcards: true
      spec:
        ingressClassName: nginx
    authentication:
      secondFactor: "off"
    kubeClusterName: "cluster-name"
    highAvailability:
      replicaCount: 1
      certManager:
        enabled: true
        issuerName: "letsencrypt-prod"
        issuerKind: ClusterIssuer</code></pre>
<h3 dir="ltr">2. Register Kubernetes Clusters</h3>
<p dir="ltr">Once the Teleport cluster is deployed, you can register your Kubernetes clusters with Teleport. One needs to configure the teleport-kube-agent in the cluster which you want to add in the teleport. </p>
<h4 dir="ltr">Manually Register a Kubernetes Cluster</h4>
<p dir="ltr" role="presentation"><strong>Deploy the Teleport Kubernetes Service:</strong><br><a href="https://www.youtube.com/watch?v=2diX_UAmJ1c"><span data-rich-links='{"fple-t":"Adding your first Kubernetes cluster to Teleport","fple-u":"https://www.youtube.com/watch?v=2diX_UAmJ1c","fple-mt":null,"type":"first-party-link"}'>Adding your first Kubernetes cluster to Teleport</span></a><br>Here you have to add  The address of your Teleport proxy server in proxyAddr and the token of the teleport cluster in the authToken.</p>
<p dir="ltr">Add the Teleport Helm Repository:</p>
<pre><code>helm repo add teleport https://charts.releases.teleport.dev
helm repo update</code></pre>
<pre><code>helm install ${RELEASE_NAME} teleport/teleport-kube-agent \
  --create-namespace \
  --namespace ${NAMESPACE} \
  --set roles="kube" \
  --set proxyAddr=${PROXY_ENDPOINT} \
  --set authToken=${JOIN_TOKEN} \
  --set kubeClusterName=${KUBERNETES_CLUSTER_NAME}</code></pre>
<p dir="ltr" role="presentation"><strong>Verify the Teleport Pod:</strong></p>
<pre><code>kubectl -n teleport-agent get pods</code></pre>
<h3>3. Configure Access Controls</h3>
<strong>Step 1: Configure Kubernetes ClusterRole and ClusterRoleBinding</strong>
<p dir="ltr">To manage access to your Kubernetes clusters using RBAC, you'll create a ClusterRole and a ClusterRoleBinding.</p>
<p dir="ltr"><strong>Create a ClusterRole</strong></p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: app-pod-viewer
rules:
- apiGroups: [""]
  resources: ["pods", "pods/log"]
  verbs: ["get", "watch", "list"]</code></pre>
<p dir="ltr">Create a file named clusterrole.yaml with the following configuration to define permissions for viewing pods and logs:</p>
<p dir="ltr"><strong>Create a ClusterRoleBinding</strong></p>
<p dir="ltr">Create a file named clusterrolebinding.yaml to bind the ClusterRole to a specific group:</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: app-pod-viewer
subjects:
- kind: Group
  name: app-developers
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: app-pod-viewer
  apiGroup: rbac.authorization.k8s.io</code></pre>
<p><strong>Apply the Configurations</strong></p>
<p dir="ltr">Apply the ClusterRole and ClusterRoleBinding using the following commands:</p>
<pre><code>kubectl apply -f clusterrole.yaml
kubectl apply -f clusterrolebinding.yaml </code></pre>
</div>
<div dir="ltr" align="left"> </div>
<div dir="ltr" align="left"><strong>Step 2: Configure Access Controls in Teleport</strong>
<p dir="ltr">Teleport can be used to manage Kubernetes access with additional controls. Follow these steps:</p>
<p dir="ltr"><strong>Create a Role in Teleport</strong></p>
<p dir="ltr">Go to the Teleport UI, navigate to Roles, and add a new role with the following YAML configuration:</p>
<div dir="ltr" align="left">
<pre><code>kind: role
metadata:
  name: app-pod-viewer
spec:
  allow:
    kubernetes_groups:
    - app-developers
    kubernetes_labels:
      '*': '*'
    kubernetes_resources:
    - kind: pod
      name: '*'
      namespace: app
    kubernetes_users:
    - app-pod-viewer
  deny: {}
  options:
    cert_format: standard
    create_db_user: false
    create_desktop_user: false
    desktop_clipboard: true
    desktop_directory_sharing: true
    enhanced_recording:
    - command
    - network
    forward_agent: false
    idp:
      saml:
        enabled: true
    max_session_ttl: 30h0m0s
    pin_source_ip: false
    port_forwarding: true
    record_session:
      default: best_effort
      desktop: true
    ssh_file_copy: true
version: v7</code></pre>
<strong>Access Resources</strong>
<p dir="ltr">Authenticate to your Kubernetes cluster via Teleport and test your access controls. </p>
<p dir="ltr">Create a User in Teleport</p>
<ul>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Go to Users in the Teleport UI and create a new user.</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">A link will be provided to set the user's password.</p>
</li>
</ul>
<p dir="ltr"><strong>Log in via CLI</strong></p>
<p dir="ltr">Use the following commands in the CLI to authenticate and access the Kubernetes cluster:</p>
<div dir="ltr" align="left">
<pre><code>tsh logout 
tsh login --proxy= --user=app 
tsh kube login  --as app-pod-viewer </code></pre>
<p dir="ltr"><strong>Access Pods and Logs</strong></p>
<p dir="ltr">After logging in, you can run the following commands to interact with the Kubernetes resources:</p>
<pre><code>tsh kubectl get pods -n app 
tsh kubectl logs pods/app-ui-svc-xyz -n app</code></pre>
<p dir="ltr"><strong>Auditor and Monitor</strong></p>
<p dir="ltr">Use Teleport's auditing capabilities to monitor and record kubectl sessions.</p>
<h4 dir="ltr">View Audit Log</h4>
<p dir="ltr" role="presentation">Access the Teleport Web Interface: Navigate to the Teleport web interface.</p>
<p dir="ltr" role="presentation">View Audit Log: Go to the "Audit Log" section to view recorded kubectl sessions.</p>
<p dir="ltr">By following these steps, you can effectively use Teleport to manage access to your Kubernetes clusters, ensuring secure and controlled access with fine-grained RBAC and auditing capabilities.</p>
<p dir="ltr">After deploying Teleport, you can configure it using various methods to suit your needs. Here are some key points to consider:</p>
<h3 dir="ltr">Configuration Methods</h3>
<p dir="ltr" role="presentation"><strong>Static Configuration File:</strong></p>
<p dir="ltr">At startup, Teleport reads a configuration file from the local filesystem (default path is /etc/teleport.yaml).</p>
<p dir="ltr">This file controls aspects of the cluster that are not expected to change frequently, such as the ports that services listen on.</p>
<p dir="ltr" role="presentation"><strong>Dynamic Resources:</strong></p>
<p dir="ltr">Dynamic resources control aspects of your cluster that are likely to change over time, such as roles, local users, and registered infrastructure resources.</p>
<p dir="ltr">These can be managed using infrastructure as code tools like Terraform, Helm, and the tctl client tool.</p>
<h3 dir="ltr">Configuration Fields</h3>
<p dir="ltr"><strong>Service Configuration:</strong></p>
<p dir="ltr">You can enable or disable various Teleport services by including the appropriate configuration in your Teleport configuration file. For example: service_name: enabled: "no"</p>
<p dir="ltr"><strong>Supported services include:</strong></p>
<ul>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Application Service (app_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Auth Service (auth_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Database Service (db_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Discovery Service (discovery_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Kubernetes Service (kubernetes_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Proxy Service (proxy_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">SSH Service (ssh_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Desktop Service (windows_desktop_service)</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Jamf Service (jamf_service).</p>
</li>
</ul>
<h3 dir="ltr">High Availability Configuration</h3>
<p dir="ltr">Storage Configuration: The storage section configures the cluster state backend and session recording backend for the Auth Service.</p>
<pre><code>Example:
version: v3
teleport:
  Storage:
# ...</code></pre>
<p dir="ltr">Consult the Backends Reference for specific fields to set in the storage section.</p>
<p dir="ltr"><strong>Auth Service Configuration:</strong></p>
<p dir="ltr">The auth_service section configures the Auth Service.</p>
<p dir="ltr">Example:</p>
<pre><code>version: v3
teleport:
  storage:
    # ...
  auth_service:
    enabled: true
    cluster_name: "mycluster.example.com"
    # Remove this if not using Teleport Enterprise
    license_file: "/var/lib/teleport/license.pem"
  Proxy_service:
enabled: false</code></pre>
<p dir="ltr">This configuration enables the Auth Service and specifies the cluster name and license file if using Teleport Enterprise.</p>
<h3 dir="ltr">Custom Configuration with Helm</h3>
<p dir="ltr">Custom YAML: You can provide custom YAML under proxy.teleportConfig and auth.teleportConfig to override elements of the default Teleport Proxy Service and Auth Service configurations.</p>
<p dir="ltr">Example:</p>
<div dir="ltr" align="left">
<pre><code>proxy:
  teleportConfig:
    proxy_service:
      public_addr: "mycluster.example.com:443"
auth:
  teleportConfig:
    auth_service:
      enabled: true
cluster_name: "mycluster.example.com"</code></pre>
<p dir="ltr">Any YAML provided under a teleportConfig section will be merged with the chart's default YAML configuration, with your overrides taking precedence.</p>
<h3 dir="ltr">Additional Considerations</h3>
<ul>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Single Sign-On (SSO): For production deployments, it is recommended to set up Single Sign-On with your provider of choice.</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Kubernetes RBAC: Fine-tune your Kubernetes RBAC to enable fine-grained controls for accessing Kubernetes resources.</p>
</li>
</ul>
<p dir="ltr">By following these guidelines, you can effectively configure your Teleport deployment to meet your specific requirements.</p>
<h3 dir="ltr">Best Practices</h3>
<ol>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Minimize API Server Flags:<br>Avoid using flags like --insecure-port, --insecure-bind-address, and --anonymous-auth to reduce security risks.</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Follow Least Privilege:<br>Assign the minimum privileges necessary for users or service accounts to perform their tasks. Use roles instead of cluster roles whenever possible, and avoid using wildcards in permissions.</p>
</li>
<li dir="ltr" aria-level="1">
<p dir="ltr" role="presentation">Avoid Default Service Accounts:<br>Create custom service accounts instead of using default ones to ensure better control over permissions.</p>
</li>
</ol>
<h3 dir="ltr">Conclusion </h3>
<p dir="ltr">Teleport provides a scalable solution to manage Kubernetes access, balancing security, usability, and compliance. It addresses the complexity of Kubernetes environments and multi-tenant setups by streamlining key, certificate, and credential management.</p>
<p dir="ltr">Prior to adopting Teleport, organizations encountered significant challenges with native Kubernetes RBAC. The manual management of RBAC across numerous clusters and users proved to be complex and prone to errors. As the number of users and clusters increased, the complexity and administrative overhead associated with RBAC also grew, leading to scalability issues. The default security settings and static credentials were vulnerable to unauthorized access and data breaches. Compliance and audit logging were difficult in multi-tenant environments, making it hard to meet regulations.</p>
<p><strong id="docs-internal-guid-415eb79b-7fff-3fb9-3775-f4aa0babd1ab"><br><br></strong></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div> <hr> <div class="d-flex align-items-center flex-wrap"></div> <hr> <div class="article__share mt-0"><ul class="social-list list-inline list--hover blog_social" style="margin:0!important;padding:0!important"><li class="list-inline-item mr-0"><a href="javascript:void(0)" class="share-network-email"><i class="socicon socicon-google icon icon--xs"></i></a></li> <li class="list-inline-item mr-0"><a href="javascript:void(0)" class="share-network-linkedin"><i class="socicon socicon-linkedin icon icon--xs"></i></a></li> <li class="list-inline-item mr-0"><a href="javascript:void(0)" class="share-network-twitter"><i class="socicon socicon-twitter icon icon--xs"></i></a></li> <li class="list-inline-item mr-0"><a href="javascript:void(0)" class="share-network-facebook"><i class="socicon socicon-facebook icon icon--xs"></i></a></li> <li class="list-inline-item mr-0"><a href="javascript:void(0)" class="share-network-whatsapp"><i class="socicon socicon-whatsapp icon icon--xs"></i></a></li></ul></div></div></div></div></section></div> <footer class="pt-4 pb-0 footer-2 bg--dark" data-v-1a1e3611><div class="container" data-v-1a1e3611><div class="row" data-v-1a1e3611><div class="col-md-3 col-sm-6 col-12 mb-5" data-v-1a1e3611><h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Company</h3> <ul class="list--hover mb-1" data-v-1a1e3611><li data-v-1a1e3611><a href="/about-us/" data-v-1a1e3611>About Us</a></li></ul> <ul class="list--hover d-flex mt-2 icons" data-v-1a1e3611><li data-v-1a1e3611><a href="https://www.facebook.com/profile.php?id=61555276800801" title="Platform Engineers facebook page" target="_blank" data-v-1a1e3611><i class="socicon socicon-facebook icon icon--xs" data-v-1a1e3611></i></a></li> <li class="px-2" data-v-1a1e3611><a href="https://twitter.com/platform_engr" title="Platform Engineers twitter account" target="_blank" data-v-1a1e3611><i class="socicon socicon-twitter icon icon--xs" data-v-1a1e3611></i></a></li> <li class="px-1" data-v-1a1e3611><a href="https://www.linkedin.com/company/platform-engineers/mycompany/" title="Platform Engineers linkedin page" target="_blank" data-v-1a1e3611><i class="socicon socicon-linkedin icon icon--xs" data-v-1a1e3611></i></a></li></ul> <h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Resources</h3> <ul class="list--hover" data-v-1a1e3611><li data-v-1a1e3611><a href="/blog/" data-v-1a1e3611>Blog</a></li> <li data-v-1a1e3611><a href="/case-studies/" data-v-1a1e3611>Case Studies</a></li></ul></div> <div class="col-md-3 col-sm-6 col-12 mb-5" data-v-1a1e3611><h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Services</h3> <ul class="list--hover" data-v-1a1e3611><li data-v-1a1e3611><a href="/services/platform-engineering/" data-v-1a1e3611>Platform Engineering</a></li><li data-v-1a1e3611><a href="/services/kubernetes-consulting-services/" data-v-1a1e3611>Kubernetes Consulting Services</a></li><li data-v-1a1e3611><a href="/services/containerization/" data-v-1a1e3611>Containerization</a></li><li data-v-1a1e3611><a href="/services/performance-optimization/" data-v-1a1e3611>Performance Optimization</a></li><li data-v-1a1e3611><a href="/services/ci-cd-implementation/" data-v-1a1e3611>CI/CD Implementation</a></li><li data-v-1a1e3611><a href="/services/infrastructure-maintenance-and-support/" data-v-1a1e3611>Infra Maintenance & Support</a></li></ul></div> <div class="col-md-3 col-sm-6 col-12 mb-5" data-v-1a1e3611><h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Industries</h3> <ul class="list--hover" data-v-1a1e3611><li data-v-1a1e3611><a href="/industries/IoT/" data-v-1a1e3611>IoT</a></li><li data-v-1a1e3611><a href="/industries/ecommerce/" data-v-1a1e3611>eCommerce</a></li><li data-v-1a1e3611><a href="/industries/fintech/" data-v-1a1e3611>FinTech</a></li><li data-v-1a1e3611><a href="/industries/SaaS/" data-v-1a1e3611>SaaS</a></li><li data-v-1a1e3611><a href="/industries/enterprise/" data-v-1a1e3611>Enterprise</a></li></ul></div> <div class="col-md-3 col-sm-6 col-12 mb-5" data-v-1a1e3611><h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Support</h3> <ul class="list--hover" data-v-1a1e3611><li data-v-1a1e3611><a href="/contact-us/" data-v-1a1e3611>Contact Us</a></li></ul> <h3 class="type--uppercase m-0 h6" data-v-1a1e3611>Assessment</h3> <ul class="list--hover" data-v-1a1e3611><li data-v-1a1e3611><a href="/assessment/" data-v-1a1e3611>Cost Assessment</a></li> <li data-v-1a1e3611><a href="/assessment/" data-v-1a1e3611>Performance Assessment</a></li></ul></div></div></div> <div class="sub-footer mt-3" data-v-1a1e3611><div class="col-md-12 text-center" data-v-1a1e3611><span class="type--fine-print" data-v-1a1e3611>© <span class="update-year" data-v-1a1e3611></span> Platform Engineers</span></div></div></footer> <a href="#start" data-scroll-class="100vh:active" title="click & go to top of the page" aria-label="click & go to top of the page" class="back-to-top inner-link"><i class="stack-interface stack-up-open-big"></i></a></div></div></div><script defer src="/_nuxt/static/1730278824/blog/teleport-for-simplified-kubernetes-access-management/state.js"></script><script src="/_nuxt/7dc4e7c.js" defer></script><script src="/_nuxt/1d8d9a4.js" defer></script><script src="/_nuxt/accecf1.js" defer></script><script src="/_nuxt/0f88427.js" defer></script><script src="/_nuxt/990548d.js" defer></script><script src="/_nuxt/b4cbe7a.js" defer></script><script data-n-head="ssr" src="https://www.googletagmanager.com/gtag/js?id=G-LRC7N9VH4L" data-body="true"></script><script data-n-head="ssr" src="/google-tag.js" data-body="true"></script><script data-n-head="ssr" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" data-body="true"></script><script data-n-head="ssr" src="/js/hljs.js" data-body="true"></script>
  </body>
</html>
